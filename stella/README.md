# Stella - 星座ビューア

スマートフォンのジャイロセンサーを用いて、実際の方角に向けながら星座を確認できる3D星空ビューア。

## 特徴

### 星空の再現
- **ヒッパルコス星表**ベース、肉眼で見える約4,500星（6等級以下）を3D天球にプロット
- 星の色はB-V色指数から計算（青白い星、黄色い星、赤い星を忠実に再現）
- 等級に応じた明るさ・サイズの差異

### 星座
- **全88星座**の星座線を表示
- 星座名は日本語で表示
- 星座リストから選択するとカメラが自動で移動し、該当星座をハイライト

### 天の川
- 銀河面に沿った天の川を15,000パーティクルで表現
- 実際の銀河座標データに基づき、誇張した美しい表現

### ジャイロセンサー対応
- スマートフォンを空にかざすと、実際の方角の星空が表示される
- iOS 13+のジャイロ許可にも対応
- ジャイロ非対応環境ではタッチドラッグ / マウスドラッグで操作

### 時刻・場所連動
- GPSで現在地を自動取得
- 現在時刻の恒星時を計算し、その場所・時刻の正確な星空を再現
- 日時・場所は手動で変更可能（過去や未来の星空も確認できる）

## 技術スタック

| 技術 | 用途 |
|---|---|
| Three.js r128 | 3D描画エンジン |
| WebGL Shader | 星のグロー効果・天の川パーティクル |
| DeviceOrientation API | ジャイロセンサー |
| Geolocation API | GPS位置情報 |
| d3-celestial | 天文データソース |

## 天文計算

### 恒星時
ユリウス日からグリニッジ恒星時（GST）を計算し、観測地の経度を加えて地方恒星時（LST）を算出。
これにより、任意の日時・場所での天球の回転角度を正確に決定する。

### 座標変換
1. **赤道座標系**（赤経・赤緯）→ Three.js 3D座標
2. **恒星時回転** → 観測時刻に応じた天球回転
3. **緯度傾斜** → 観測地の緯度に応じた天の北極の仰角

### 星の色
B-V色指数から実効温度を推定し、黒体輻射に近い色を生成：
- B-V < 0: 青白い星（O型・B型星）
- B-V ≈ 0.4: 白〜黄白色（A型・F型星）
- B-V ≈ 0.8: 黄色（G型星、太陽類似）
- B-V > 1.0: 橙〜赤色（K型・M型星）

## データソース

- **星データ**: [d3-celestial stars.6.json](https://github.com/ofrohn/d3-celestial) - ヒッパルコス星表から6等級以下を抽出
- **星座線**: [d3-celestial constellations.lines.json](https://github.com/ofrohn/d3-celestial) - IAU準拠の全88星座
- **星座名**: [d3-celestial constellations.json](https://github.com/ofrohn/d3-celestial) - 日本語含む多言語対応
- **天の川**: [d3-celestial mw.json](https://github.com/ofrohn/d3-celestial) - 天の川の輪郭ポリゴン
- **ライセンス**: BSD 3-Clause (d3-celestial)

## 操作方法

### スマートフォン
1. ページを開くとジャイロ許可を求められます（iOS）
2. 端末を空にかざすと、その方角の星空が表示されます
3. 画面下部の「☰ 星座一覧」から星座を選択できます

### PC
1. マウスドラッグで視点を回転
2. 星座一覧パネルから星座を選択

### 日時・場所の変更
1. 星座一覧パネルの「日時・場所」タブを開く
2. 日付・時刻・緯度・経度を入力
3. 「適用」をタップ
4. 「現在に戻す」で現在地・現在時刻に戻る

## 動作環境
- iOS Safari 13+
- Android Chrome
- デスクトップ Chrome / Firefox / Safari
- HTTPS必須（ジャイロ・GPS利用のため。GitHub Pagesは対応済み）
